<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tucunar√© Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style type="text/css">
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }
    body {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
    }
    #tc-canvas {
      background-color: black;
      position: absolute;
      top: 0; left: 0;
    }
  </style>

  <script type="text/javascript" src="src/keys.js"     ></script>
  <script type="text/javascript" src="src/vector.js"   ></script>
  <script type="text/javascript" src="src/matrix.js"   ></script>
  <script type="text/javascript" src="src/mathutils.js"></script>
  <script type="text/javascript" src="src/shader.js"   ></script>
  <script type="text/javascript" src="src/tucunare.js" ></script>

  <script type="text/javascript">
    function main() {
      var canvas = document.getElementById("tc-canvas");
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      var tc = new Tucunare(canvas);
      tc.setClearColor(new vec4(0, 0, 0, 1));

      var projectionMatrix = null;
      function windowResized() {
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
        tc.resize();
        projectionMatrix = mat4.perspectiveAspectRatio(canvas.width / canvas.height, 75, 0.1, 1000);
        draw();
      };
      window.onresize = windowResized;

      var points = [
        new vec4(-1,-1, 0, 1), // bottom left
        new vec4( 1,-1, 0, 1), // bottom right
        new vec4( 0, 1, 0, 1)  // top middle
      ];
      var colors = [
        new vec4(1, 0, 0, 1), // red
        new vec4(0, 1, 0, 1), // green
        new vec4(0, 0, 1, 1)  // blue
      ];

      var vertShader = new Shader();
      vertShader.main = function(input) {
        return {
          position: this.uniforms.mvp.multiplyV4(input.point),
          output: {
            color: input.color
          }
        }
      };

      var fragShader = new Shader();
      fragShader.main = function(input) {
        return input.color;
      };

      var camera = new vec4(0, 0, 2, 1);
      var viewMatrix = mat4.translate(-camera.x, -camera.y, -camera.z);

      function draw() {
        // include any model transformations in the multiplication here
        var mvpMatrix = projectionMatrix.multiply(viewMatrix);

        vertShader.uniforms.mvp = mvpMatrix;
        vertShader.incoming.point = points;
        vertShader.incoming.color = colors;
        tc.drawTriangles(vertShader, fragShader);

        // flush the buffer to the canvas
        tc.flush();
      }

      // manually call the resized function to init the projection matrix and draw the scene
      windowResized();
    }
  </script>
</head>
<body onload="main()">
  <canvas id="tc-canvas"></canvas>
</body>
</html>
